# 2.Service Worker 

### 1.å¼€å§‹åˆ›å»ºï¼š

```javascript
 ~ cd desktop           
âœ  desktop mkdir pwa-learn
âœ  desktop cd pwa-learn
âœ  pwa-learn touch index.html       //åˆ›å»ºä¸€ä¸ªindex
âœ  pwa-learn touch sw.js          //åˆ›å»ºä¸€ä¸ªswçš„jsæ–‡ä»¶
âœ  pwa-learn npm install serve -g     //å®‰è£…ä¸€ä¸ªæ¨¡å—
âœ  pwa-learn serve       //---å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨
```

åˆ›å»ºå¥½äº†ä¸Šé¢çš„æ–‡ä»¶åğŸ¤–ï¼š

```html
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Learn PWA</title>
    </head>
    <body>
        <script>
            //registerç¬¬ä¸€ä¸ªå‚æ•°servceworkerå…³è”è„šæœ¬çš„åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡
            navigator
                .serviceWorker
                .register("./sw.js", {scope: "/"})//scope: "/"è¡¨ç¤ºæ‰€æœ‰é¡µé¢
                .then(registeraton => {
                    console.log(registeraton);
                }, err => {
                    console.error(err);
                })
        </script>
    </body>
</html>
```

å†æ‰“å¼€åˆšæ‰çš„æœåŠ¡å™¨locallhost:5000ğŸƒï¼š

![](/Users/xuyongqi/Desktop/pwa-learn/PWA/1.png)



2.ç„¶åæ¥ä¸‹æ¥å¼€å§‹çœŸçš„serviceworkçš„ç¼–ç¨‹ï¼š

ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼š

- install
- activate
- fetch

```javascript
self.addEventListener("install",event=>{
    console.log(event);
    event.waitUntil(new Promise(resolve=>{
        setTimeout(resolve,5000);
    }))
    event.waitUntil(self.skipaWaiting());
});
self.addEventListener("activate",event=>{
    console.log(event);
    event.waitUntil(self.clients.claim());
});
self.addEventListener("fetch",event=>{
    console.log(event);
});
```

ä¸‹é¢è¯¦ç»†çš„è¯´ä¸‹æ¯ä¸ªç”Ÿå‘½å‘¨æœŸä¸‹éœ€è¦æŒæ¡çš„æ–¹æ³•ï¼Œå®åœ¨æ˜¯å¤ªéš¾äº†ï¼š

- install
  - event.waitUntilï¼šæ¥å—ä¸€ä¸ªpromiseï¼Œéœ€è¦ç­‰å¾…promiseæ‰§è¡Œå®Œæˆä¹‹åå†è¿›å…¥ä¸‹ä¸ªç”Ÿå‘½å‘¨æœŸï¼›ä¾‹å­çš„æ„æ€æ˜¯--è¿›å…¥åˆ°äº†"install"ä¸­ï¼Œ5ç§’åè¿›å…¥"activate"ä¸­å»ã€‚
  - self.skipaWaiting :åœæ­¢â¹æ—§ç‰ˆæœ¬çš„srwkï¼Œå¼€å¯æ–°çš„srwk
- activate
  - event.waitUntil:å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸ç»™é’±ï¼Œ ä¸æŒªåœ°æ–¹
  - self.clients.claim:è®©ç¬¬ä¸€æ¬¡åŠ è½½çš„é¡µé¢å¯ä»¥å—srwkçš„æ§åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¬¬ä¸€æ¬¡æ˜¯ä¸å—srwkçš„æ§åˆ¶çš„

