# 5.cache API

ä¸‹é¢æ¥ç€ç¬¬äºŒç¯‡Service Workerçš„ä»£ç ç»§ç»­å¾€ä¸‹ğŸƒ

```javascript
//ğŸ—¿
const CACHE_NAME="cache-v1";       //ç¼“å­˜åå­—
self.addEventListener("install",event=>{
    console.log(event);
    event.waitUntil(caches.open(CACHE_NAME).then(cache=>{
      cache.addAll(["/","./index.css"]);//å†™å…¥ç¼“å­˜ï¼ˆè¿™é‡Œçš„é¡¹ç›®åˆ—è¡¨åº”è¯¥åœ¨é¡¹ç›®æ„å»ºçš„æ—¶å€™è‡ªåŠ¨å¾—åˆ°ï¼Œä¸åº”è¯¥äººå·¥ç»´æŠ¤ï¼‰ 
    }));
});

//ğŸ¯
self.addEventListener("activate",event=>{
    console.log(event);
    event.waitUntil(caches.keys().then(cacheNames=>{
        return Promise.all(cacheNames.map(cName=>{
            if(cName !==CACHE_NAME){  //æ¸…ç†ä¹‹å‰æ²¡ç”¨çš„ç¼“å­˜
                return caches.delete(cName);
            }
        }))
    }));
});

//ğŸ§µ:
self.addEventListener("fetch",event=>{
    console.log(event);
    event.respondWith(caches.open(CACHE_NAME).then(cache=>{
        return cache.match(event.request).then(res=>{
            if(res){
                console.log(res);
                return res;
            }
            return fetch(event.request).then(response=>{   
                cache.put(event.request,response.clone());//responseæ˜¯æµå¼çš„ï¼Œä¸ºäº†ç¼“å­˜å¯è¯»å–ï¼Œè¦å…‹éš†ä¸€ä»½å‡ºæ¥
                return response;
            });
        })
    }));
});
```

- caches.open:æ‰“å¼€ä¸€ä¸ªç¼“å­˜ç©ºé—´ï¼›
  - å‚æ•°ï¼šéœ€è¦ä¼ å…¥ä¸€ä¸ªç¼“å­˜åå­—
  - è¿”å›å€¼ï¼šopenæ–¹æ³•å¾—åˆ°ä¸€ä¸ªpromise
- cacahe.Addall:å†™å…¥ç¼“å­˜çš„æ–¹æ³•
  - å‚æ•°ï¼šæ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹å°±æ˜¯ä¸€ä¸ªç¼“å­˜çš„è·¯å¾„ã€‚
- fetchæ˜¯å¯ä»¥æ¥å—ä¸€ä¸ªrequestå¯¹è±¡çš„



